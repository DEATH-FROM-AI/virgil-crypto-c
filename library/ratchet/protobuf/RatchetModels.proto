syntax = "proto3";

message Empty {
}

message RegularMessage {
	uint32 version = 1;
	uint32 counter = 2;
	bytes public_key = 3;
	bytes cipher_text = 4;
}

message PrekeyMessage {
	uint32 version = 1;
	bytes sender_identity_key = 2;
	bytes sender_ephemeral_key = 3;
	bytes receiver_long_term_key = 4;
	bytes receiver_one_time_key = 5;
	RegularMessage regular_message = 6;
}

message ChainKey {
	uint32 index = 1;
	bytes key = 2;
}

message MessageKey {
	uint32 index = 1;
	bytes key = 2;
}

message SenderChain {
	bytes private_key = 1;
	bytes public_key = 2;
	ChainKey chain_key = 3;
}

message ReceiverChain {
	bytes public_key = 1;
	ChainKey chain_key = 2;
}

message SkippedMessageKey {
	bytes public_key = 1;
	MessageKey message_key = 2;
}

message Ratchet {
	oneof sender_chain {
		SenderChain sender_chain_value = 1;
		Empty empty = 2;
	}
	bytes root_key = 3;
	repeated ReceiverChain receiver_chains = 4;
	repeated SkippedMessageKey skipped_message_keys = 5;
}

message Session {
	bool received_first_response = 1;
	bool is_initiator = 2;
	bytes sender_identity_key = 3;
	bytes sender_ephemeral_key = 4;
	bytes receiver_long_term_key = 5;
	bytes receiver_one_time_key = 6;
	Ratchet ratchet = 7;
}

message Message {
	uint32 version = 1;
	oneof message {
		RegularMessage regular_message = 2;
		PrekeyMessage prekey_message = 3;
	}
}