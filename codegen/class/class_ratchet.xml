<class name="ratchet" context="public">

    <require header="virgil/foundation/vscf_hmac256.h" scope="public"/>
    <require header="virgil/foundation/vscf_hkdf.h" scope="public"/>
    <require header="virgil/foundation/vscf_error_ctx.h" scope="private"/>
    <require header="ed25519/ed25519.h" is_system="1" scope="private"/>

    <require class="olm message" scope="public"/>
    <require class="olm message key" scope="public"/>
    <require class="olm kdf info" scope="public"/>
    <require class="olm sender chain" scope="public"/>
    <require class="olm chain key" scope="public"/>
    <require class="olm cipher" scope="public"/>

    <constant name="olm message version" value="1"/>
    <constant name="olm shared key length" value="vscf_hmac256_DIGEST_LEN"/>

    <variable name="olm chain key seed" type="unsigned" size="1" declaration="private" definition="private">
        <array length="derived"/>
        <value value="0x02"/>
    </variable>

    <variable name="olm message key seed" type="unsigned" size="1" declaration="private" definition="private">
        <array length="derived"/>
        <value value="0x01"/>
    </variable>

    <property name="cipher" class="olm cipher" access="readwrite"/>
    <property name="kdf info" class="olm kdf info" access="readwrite"/>
    <property name="sender chain" class="olm sender chain" access="readwrite"/>
    <property name="receiver chains" class="olm receiver chain list node" access="readwrite"/>
    <property name="root key" class="buffer" access="readwrite"/>

    <method name="advance root chain" declaration="private">
        <argument class="context" access="readwrite"/>
    </method>

    <method name="create message key" declaration="private">
        <argument name="chain key" class="olm chain key" access="readwrite"/>

        <return class="olm message key" access="readwrite"/>
    </method>

    <method name="advance chain key" declaration="private">
        <argument name="chain key" class="olm chain key" access="readwrite"/>
    </method>

    <method name="initiate">
        <argument class="context"/>
        <argument name="shared secret" class="data"/>
        <argument name="ratchet private key" class="buffer"/>
    </method>

    <method name="respond">
        <argument class="context"/>
        <argument name="shared secret" class="data"/>
        <argument name="ratchet public key" class="buffer"/>
    </method>

    <method name="encrypt len">
        <argument class="context"/>
        <argument name="plain text" class="data"/>

        <return type="size"/>
    </method>

    <method name="encrypt">
        <argument class="context"/>
        <argument name="plain text" class="data"/>
        <argument name="cipher text" class="buffer"/>

        <return type="error"/>
    </method>

    <method name="decrypt">
        <argument class="context"/>
        <argument name="cipher text" class="data"/>
        <argument name="plain text" class="buffer"/>

        <return type="error"/>
    </method>

</class>
