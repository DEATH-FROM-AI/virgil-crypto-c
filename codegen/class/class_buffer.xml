<class name="buffer" context="private">
    Encapsulates fixed byte array with variable effective data length.

    <require module="data"/>


    <property name="bytes" type="data" access="readwrite">
        Underlying byte array.
    </property>


    <property name="capacity" type="size">
        Byte array capacity - total allocated bytes.
    </property>


    <property name="len" type="size">
        Byte array length - actually used bytes from the beginning.
    </property>


    <property name="bytes_dealloc" callback=".(global_callback_dealloc)">
        Function do deallocate underlying byte array.
    </property>


    <constructor name="with capacity">
        Allocate context and underlying byte array.

        <argument name="capacity" type="size"/>
    </constructor>


    <method name="alloc">
        Allocates inner buffer with a given capacity.
        Precondition: buffer is initialized.
        Precondition: buffer does not hold any bytes.
        Postcondition: inner buffer is allocated.

        <argument class="context"/>
        <argument name="capacity" type="size"/>
    </method>


    <method name="use">
        Use given data as output buffer.
        Client side is responsible for data deallocation.
        Precondition: buffer is initialized.
        Precondition: buffer does not hold any bytes.

        <argument class="context"/>
        <argument name="bytes" type="data" access="readwrite"/>
        <argument name="bytes len" type="size"/>
    </method>


    <method name="take">
        Use given data as output buffer.
        Buffer is responsible for data deallocation.
        Precondition: buffer is initialized.
        Precondition: buffer does not hold any bytes.

        <argument class="context"/>
        <argument name="bytes" type="data" access="readwrite"/>
        <argument name="bytes len" type="size"/>
        <argument name="dealloc" callback=".(global_callback_dealloc)"/>
    </method>


    <method name="is full">
        Returns true if buffer full.

        <argument class="context" access="readonly"/>
        <return type="boolean"/>
    </method>


    <method name="is valid">
        Returns true if buffer is configured and has valid internal states.

        <argument class="context" access="readonly"/>
        <return type="boolean"/>
    </method>


    <method name="bytes">
        Returns underlying buffer bytes.

        <argument class="context" access="readonly"/>
        <return type="data" access="readonly">
            <array access="disown"/>
        </return>
    </method>

    <method name="data">
        Returns underlying buffer bytes as object.

        <argument class="context" access="readonly"/>
        <return class=".(class_data_struct_data)" is_reference="0" access="readwrite"/>
    </method>


    <method name="capacity">
        Returns buffer capacity.

        <argument class="context" access="readonly"/>
        <return type="size"/>
    </method>


    <method name="len">
        Returns buffer length - length of bytes actually used.

        <argument class="context" access="readonly"/>
        <return type="size"/>
    </method>


    <method name="left">
        Returns length of left bytes - bytes that are not in use yet.

        <argument class="context" access="readonly"/>
        <return type="size"/>
    </method>


    <method name="ptr">
        Returns pointer to the current wirte position.

        <argument class="context"/>
        <return type="byte" access="readwrite" is_reference="1"/>
    </method>


    <method name="reserve">
        Increase used bytes by given length.

        <argument class="context"/>
        <argument name="len" type="size"/>
    </method>
</class>
